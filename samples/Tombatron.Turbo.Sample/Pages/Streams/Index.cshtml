@page
@model Tombatron.Turbo.Sample.Pages.Streams.IndexModel
@{
    ViewData["Title"] = "Turbo Streams Demo";
}

<h1>Turbo Streams Demo</h1>

<p>
    This page demonstrates real-time updates using Turbo Streams over SignalR.
    Open this page in multiple browser tabs to see updates sync across all clients.
</p>

<!-- Subscribe to the demo stream -->
<turbo-stream-source-signalr stream="demo-notifications" hub-url="/turbo-hub"></turbo-stream-source-signalr>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
    <div>
        <h2>Send Notification</h2>
        <p>Send a notification to all subscribers of the "demo-notifications" stream:</p>

        <form method="post" asp-page-handler="SendNotification">
            <input type="text" name="message" placeholder="Enter a message..." style="width: 200px; padding: 8px;" />
            <button type="submit" class="btn">Send</button>
        </form>

        <h3>Live Notifications</h3>
        <div id="notification-list" style="min-height: 100px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
            <!-- Notifications will appear here -->
        </div>

        <form method="post" asp-page-handler="ClearNotifications" style="margin-top: 10px;">
            <button type="submit" class="btn btn-danger">Clear</button>
        </form>
    </div>

    <div>
        <h2>Counter Example</h2>
        <p>Click the button to increment a counter (updates in real-time for all subscribers):</p>

        <div style="font-size: 2em; margin: 20px 0;">
            Counter: <span id="counter-value"><strong>0</strong></span>
        </div>

        <form method="post" asp-page-handler="IncrementCounter">
            <button type="submit" class="btn">Increment</button>
        </form>
    </div>
</div>

<div style="margin-top: 30px;">
    <h2>Broadcast to All Clients</h2>
    <p>This sends a message to <em>all</em> connected clients, not just those subscribed to a specific stream:</p>

    <form method="post" asp-page-handler="Broadcast">
        <input type="text" name="message" placeholder="Broadcast message..." style="width: 300px; padding: 8px;" />
        <button type="submit" class="btn">Broadcast to All</button>
    </form>

    <h3>Broadcast Messages</h3>
    <div id="broadcast-list" style="min-height: 100px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
        <!-- Broadcast messages will appear here -->
    </div>
</div>

<div style="margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 4px;">
    <h3>How It Works</h3>
    <ul>
        <li>The <code>&lt;turbo-stream-source-signalr&gt;</code> element connects to the SignalR hub</li>
        <li>It subscribes to the "demo-notifications" stream</li>
        <li>When the server calls <code>ITurbo.Stream()</code>, updates are pushed to all subscribers</li>
        <li>The connection status indicator in the navigation shows real-time connection state</li>
        <li>Try opening this page in multiple tabs to see updates sync!</li>
    </ul>
</div>

<p style="margin-top: 20px;"><a href="/" class="btn">Back to Home</a></p>
