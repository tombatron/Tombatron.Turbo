@page
@model Tombatron.Turbo.Sample.Pages.Streams.IndexModel
@{
    ViewData["Title"] = "Turbo Streams Demo";
}

<h1>Real-time Streams</h1>
<p>
    Experience real-time updates via SignalR. Open this page in multiple browser tabs to see updates sync instantly.
</p>

<!-- Subscribe to the demo stream -->
<turbo-stream-source-signalr stream="demo-notifications" hub-url="/turbo-hub"></turbo-stream-source-signalr>

<div class="grid">
    <div class="card">
        <h2>Send Notification</h2>
        <p>Send a message to all subscribers of this stream:</p>

        <form method="post" asp-page-handler="SendNotification">
            <div class="form-row">
                <input type="text" name="message" placeholder="Enter a message..." style="flex: 1;" />
                <button type="submit" class="btn">Send</button>
            </div>
        </form>

        <h3>Live Notifications</h3>
        <div id="notification-list" class="notification-list">
            <!-- Notifications will appear here -->
        </div>

        <form method="post" asp-page-handler="ClearNotifications" style="margin-top: 12px;">
            <button type="submit" class="btn btn-secondary btn-sm">Clear All</button>
        </form>
    </div>

    <div class="card">
        <h2>Live Counter</h2>
        <p>Click to increment - updates in real-time for all subscribers:</p>

        <div class="counter-display">
            <span id="counter-value">0</span>
        </div>

        <form method="post" asp-page-handler="IncrementCounter" style="text-align: center;">
            <button type="submit" class="btn">Increment Counter</button>
        </form>
    </div>
</div>

<div class="card">
    <h2>Broadcast to Everyone</h2>
    <p>This sends a message to <em>all</em> connected clients, not just stream subscribers:</p>

    <form method="post" asp-page-handler="Broadcast">
        <div class="form-row">
            <input type="text" name="message" placeholder="Broadcast message..." style="flex: 1;" />
            <button type="submit" class="btn">Broadcast</button>
        </div>
    </form>

    <h3>Broadcast Messages</h3>
    <div id="broadcast-list" class="notification-list">
        <!-- Broadcast messages will appear here -->
    </div>
</div>

<div class="info-box">
    <h3>How It Works</h3>
    <ul>
        <li>The <code>&lt;turbo-stream-source-signalr&gt;</code> element connects to the SignalR hub</li>
        <li>It subscribes to the <code>demo-notifications</code> stream</li>
        <li>When the server calls <code>ITurbo.Stream()</code>, updates are pushed instantly</li>
        <li>The status indicator in the header shows your connection state</li>
        <li>Try opening multiple tabs to see real-time synchronization!</li>
    </ul>
</div>

<a href="/" class="back-link">&larr; Back to Home</a>
