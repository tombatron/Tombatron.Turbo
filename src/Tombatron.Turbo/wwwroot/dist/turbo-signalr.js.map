{"version":3,"file":"turbo-signalr.js","sources":["../src/turbo-stream-source-signalr.js"],"sourcesContent":["/**\n * Turbo Stream Source SignalR - Custom element for receiving Turbo Streams via SignalR\n *\n * This custom element connects to an ASP.NET Core SignalR hub and subscribes to\n * named streams. When Turbo Stream messages are received, they are rendered\n * using the Hotwire Turbo library.\n *\n * Usage:\n *   <turbo-stream-source-signalr stream=\"my-stream\" hub-url=\"/turbo-hub\"></turbo-stream-source-signalr>\n */\n\nimport * as signalR from '@microsoft/signalr';\n\n// Singleton connection manager\nconst connectionManager = {\n    /** @type {signalR.HubConnection|null} */\n    connection: null,\n\n    /** @type {Map<string, number>} Stream name to reference count */\n    streamRefs: new Map(),\n\n    /** @type {Set<string>} Streams currently subscribed on the server */\n    subscribedStreams: new Set(),\n\n    /** @type {string|null} Current hub URL */\n    hubUrl: null,\n\n    /** @type {boolean} Whether we're currently connected */\n    isConnected: false,\n\n    /** @type {boolean} Whether we're currently connecting */\n    isConnecting: false,\n\n    /** @type {Array<Function>} Callbacks waiting for connection */\n    connectionCallbacks: [],\n\n    /**\n     * Gets or creates a connection to the specified hub URL.\n     * @param {string} hubUrl - The SignalR hub URL\n     * @returns {Promise<signalR.HubConnection>}\n     */\n    async getConnection(hubUrl) {\n        // If we have a connection to a different URL, close it\n        if (this.connection && this.hubUrl !== hubUrl) {\n            await this.closeConnection();\n        }\n\n        // If already connected, return the connection\n        if (this.connection && this.isConnected) {\n            return this.connection;\n        }\n\n        // If currently connecting, wait for it\n        if (this.isConnecting) {\n            return new Promise((resolve) => {\n                this.connectionCallbacks.push(() => resolve(this.connection));\n            });\n        }\n\n        // Create new connection\n        this.isConnecting = true;\n        this.hubUrl = hubUrl;\n\n        this.connection = new signalR.HubConnectionBuilder()\n            .withUrl(hubUrl)\n            .withAutomaticReconnect({\n                nextRetryDelayInMilliseconds: (retryContext) => {\n                    // Exponential backoff: 0s, 2s, 4s, 8s, 16s, max 30s\n                    const delay = Math.min(Math.pow(2, retryContext.previousRetryCount) * 1000, 30000);\n                    return delay;\n                }\n            })\n            .configureLogging(signalR.LogLevel.Warning)\n            .build();\n\n        // Set up message handler\n        this.connection.on('TurboStream', (html) => {\n            this.handleTurboStream(html);\n        });\n\n        // Set up reconnection handlers\n        this.connection.onreconnecting(() => {\n            this.isConnected = false;\n            this.dispatchConnectionEvent('turbo:signalr:reconnecting');\n        });\n\n        this.connection.onreconnected(async () => {\n            this.isConnected = true;\n            this.dispatchConnectionEvent('turbo:signalr:reconnected');\n\n            // Resubscribe to all active streams\n            await this.resubscribeAll();\n        });\n\n        this.connection.onclose(() => {\n            this.isConnected = false;\n            this.subscribedStreams.clear();\n            this.dispatchConnectionEvent('turbo:signalr:disconnected');\n        });\n\n        try {\n            await this.connection.start();\n            this.isConnected = true;\n            this.isConnecting = false;\n            this.dispatchConnectionEvent('turbo:signalr:connected');\n\n            // Notify any waiting callbacks\n            this.connectionCallbacks.forEach((cb) => cb());\n            this.connectionCallbacks = [];\n\n            return this.connection;\n        } catch (error) {\n            this.isConnecting = false;\n            this.dispatchConnectionEvent('turbo:signalr:error', { error });\n            throw error;\n        }\n    },\n\n    /**\n     * Closes the current connection.\n     */\n    async closeConnection() {\n        if (this.connection) {\n            await this.connection.stop();\n            this.connection = null;\n            this.hubUrl = null;\n            this.isConnected = false;\n            this.subscribedStreams.clear();\n        }\n    },\n\n    /**\n     * Subscribes to a stream, incrementing the reference count.\n     * @param {string} streamName - The stream name to subscribe to\n     * @param {string} hubUrl - The SignalR hub URL\n     * @returns {Promise<boolean>} True if subscription was successful\n     */\n    async subscribe(streamName, hubUrl) {\n        if (typeof streamName !== 'string') {\n            throw new Error('Stream name is required and must be a string');\n        }\n\n        const trimmedName = streamName.trim();\n        if (trimmedName.length === 0) {\n            throw new Error('Stream name cannot be empty or whitespace');\n        }\n\n        // Increment reference count\n        const currentCount = this.streamRefs.get(trimmedName) || 0;\n        this.streamRefs.set(trimmedName, currentCount + 1);\n\n        // If this is the first reference, subscribe on the server\n        if (currentCount === 0) {\n            try {\n                const connection = await this.getConnection(hubUrl);\n                const success = await connection.invoke('Subscribe', trimmedName);\n\n                if (success) {\n                    this.subscribedStreams.add(trimmedName);\n                    return true;\n                } else {\n                    // Subscription was denied (authorization failed)\n                    this.streamRefs.set(trimmedName, currentCount);\n                    return false;\n                }\n            } catch (error) {\n                // Rollback reference count on error\n                this.streamRefs.set(trimmedName, currentCount);\n                throw error;\n            }\n        }\n\n        return true;\n    },\n\n    /**\n     * Unsubscribes from a stream, decrementing the reference count.\n     * @param {string} streamName - The stream name to unsubscribe from\n     * @returns {Promise<void>}\n     */\n    async unsubscribe(streamName) {\n        if (!streamName) {\n            return;\n        }\n\n        const trimmedName = streamName.trim();\n        const currentCount = this.streamRefs.get(trimmedName) || 0;\n\n        if (currentCount <= 0) {\n            return;\n        }\n\n        const newCount = currentCount - 1;\n\n        if (newCount === 0) {\n            // Last reference, unsubscribe from server\n            this.streamRefs.delete(trimmedName);\n            this.subscribedStreams.delete(trimmedName);\n\n            if (this.connection && this.isConnected) {\n                try {\n                    await this.connection.invoke('Unsubscribe', trimmedName);\n                } catch (error) {\n                    // Ignore errors during unsubscribe (connection might be closing)\n                    // eslint-disable-next-line no-console\n                    console.warn('Error unsubscribing from stream:', error);\n                }\n            }\n        } else {\n            this.streamRefs.set(trimmedName, newCount);\n        }\n    },\n\n    /**\n     * Resubscribes to all active streams after reconnection.\n     */\n    async resubscribeAll() {\n        if (!this.connection || !this.isConnected) {\n            return;\n        }\n\n        const streamsToResubscribe = Array.from(this.streamRefs.keys());\n\n        for (const streamName of streamsToResubscribe) {\n            try {\n                const success = await this.connection.invoke('Subscribe', streamName);\n                if (success) {\n                    this.subscribedStreams.add(streamName);\n                }\n            } catch (error) {\n                // eslint-disable-next-line no-console\n                console.warn('Error resubscribing to stream:', streamName, error);\n            }\n        }\n    },\n\n    /**\n     * Handles incoming Turbo Stream messages.\n     * @param {string} html - The Turbo Stream HTML\n     */\n    handleTurboStream(html) {\n        if (!html) {\n            return;\n        }\n\n        // Check if Turbo.js is available\n        if (typeof window !== 'undefined' && window.Turbo && typeof window.Turbo.renderStreamMessage === 'function') {\n            window.Turbo.renderStreamMessage(html);\n        } else {\n            // Fallback: manually insert the stream actions\n            this.manualRenderStream(html);\n        }\n    },\n\n    /**\n     * Manually renders Turbo Stream HTML when Turbo.js is not available.\n     * @param {string} html - The Turbo Stream HTML\n     */\n    manualRenderStream(html) {\n        const template = document.createElement('template');\n        template.innerHTML = html;\n\n        const streams = template.content.querySelectorAll('turbo-stream');\n\n        for (const stream of streams) {\n            const action = stream.getAttribute('action');\n            const target = stream.getAttribute('target');\n            const templateContent = stream.querySelector('template');\n\n            if (!target) {\n                continue;\n            }\n\n            const targetElement = document.getElementById(target);\n\n            if (!targetElement && action !== 'remove') {\n                continue;\n            }\n\n            const content = templateContent ? templateContent.content.cloneNode(true) : null;\n\n            switch (action) {\n                case 'append':\n                    if (content) {\n                        targetElement.appendChild(content);\n                    }\n                    break;\n                case 'prepend':\n                    if (content) {\n                        targetElement.prepend(content);\n                    }\n                    break;\n                case 'replace':\n                    if (content && targetElement.parentNode) {\n                        targetElement.parentNode.replaceChild(content, targetElement);\n                    }\n                    break;\n                case 'update':\n                    if (targetElement) {\n                        targetElement.innerHTML = '';\n                        if (content) {\n                            targetElement.appendChild(content);\n                        }\n                    }\n                    break;\n                case 'remove':\n                    if (targetElement) {\n                        targetElement.remove();\n                    }\n                    break;\n                case 'before':\n                    if (content && targetElement.parentNode) {\n                        targetElement.parentNode.insertBefore(content, targetElement);\n                    }\n                    break;\n                case 'after':\n                    if (content && targetElement.parentNode) {\n                        targetElement.parentNode.insertBefore(content, targetElement.nextSibling);\n                    }\n                    break;\n            }\n        }\n    },\n\n    /**\n     * Dispatches a custom event on the document.\n     * @param {string} eventName - The event name\n     * @param {object} detail - Optional event detail\n     */\n    dispatchConnectionEvent(eventName, detail = {}) {\n        if (typeof document !== 'undefined') {\n            document.dispatchEvent(new CustomEvent(eventName, { detail }));\n        }\n    },\n\n    /**\n     * Gets the current connection state.\n     * @returns {{ isConnected: boolean, streamCount: number, streams: string[] }}\n     */\n    getState() {\n        return {\n            isConnected: this.isConnected,\n            streamCount: this.streamRefs.size,\n            streams: Array.from(this.streamRefs.keys())\n        };\n    }\n};\n\n/**\n * Custom element for Turbo Stream sources via SignalR.\n *\n * @example\n * <turbo-stream-source-signalr stream=\"notifications\" hub-url=\"/turbo-hub\">\n * </turbo-stream-source-signalr>\n */\nclass TurboStreamSourceSignalR extends HTMLElement {\n    static get observedAttributes() {\n        return ['stream', 'hub-url'];\n    }\n\n    constructor() {\n        super();\n        this._streamName = null;\n        this._hubUrl = null;\n        this._subscribed = false;\n    }\n\n    /**\n     * Called when the element is added to the DOM.\n     */\n    async connectedCallback() {\n        this._streamName = this.getAttribute('stream');\n        this._hubUrl = this.getAttribute('hub-url') || '/turbo-hub';\n\n        if (this._streamName) {\n            await this._subscribe();\n        }\n    }\n\n    /**\n     * Called when the element is removed from the DOM.\n     */\n    async disconnectedCallback() {\n        if (this._subscribed && this._streamName) {\n            await connectionManager.unsubscribe(this._streamName);\n            this._subscribed = false;\n        }\n    }\n\n    /**\n     * Called when an observed attribute changes.\n     * @param {string} name - Attribute name\n     * @param {string|null} oldValue - Previous value\n     * @param {string|null} newValue - New value\n     */\n    async attributeChangedCallback(name, oldValue, newValue) {\n        if (oldValue === newValue) {\n            return;\n        }\n\n        if (name === 'stream') {\n            // Unsubscribe from old stream\n            if (this._subscribed && this._streamName) {\n                await connectionManager.unsubscribe(this._streamName);\n                this._subscribed = false;\n            }\n\n            // Subscribe to new stream\n            this._streamName = newValue;\n            if (this._streamName && this.isConnected) {\n                await this._subscribe();\n            }\n        } else if (name === 'hub-url') {\n            this._hubUrl = newValue || '/turbo-hub';\n\n            // Reconnect with new URL if already subscribed\n            if (this._subscribed && this._streamName) {\n                await connectionManager.unsubscribe(this._streamName);\n                this._subscribed = false;\n                await this._subscribe();\n            }\n        }\n    }\n\n    /**\n     * Subscribes to the current stream.\n     */\n    async _subscribe() {\n        if (!this._streamName) {\n            return;\n        }\n\n        // Ensure hubUrl is set (may not be if attributeChangedCallback fires for 'stream' before 'hub-url')\n        if (!this._hubUrl) {\n            this._hubUrl = this.getAttribute('hub-url') || '/turbo-hub';\n        }\n\n        try {\n            const success = await connectionManager.subscribe(this._streamName, this._hubUrl);\n            this._subscribed = success;\n\n            if (!success) {\n                this.dispatchEvent(new CustomEvent('turbo:stream:unauthorized', {\n                    bubbles: true,\n                    detail: { stream: this._streamName }\n                }));\n            }\n        } catch (error) {\n            this.dispatchEvent(new CustomEvent('turbo:stream:error', {\n                bubbles: true,\n                detail: { stream: this._streamName, error }\n            }));\n        }\n    }\n\n    /**\n     * Gets the current stream name.\n     * @returns {string|null}\n     */\n    get stream() {\n        return this._streamName;\n    }\n\n    /**\n     * Sets the stream name.\n     * @param {string} value\n     */\n    set stream(value) {\n        this.setAttribute('stream', value);\n    }\n\n    /**\n     * Gets the hub URL.\n     * @returns {string}\n     */\n    get hubUrl() {\n        return this._hubUrl || '/turbo-hub';\n    }\n\n    /**\n     * Sets the hub URL.\n     * @param {string} value\n     */\n    set hubUrl(value) {\n        this.setAttribute('hub-url', value);\n    }\n}\n\n// Register the custom element\nif (typeof customElements !== 'undefined') {\n    customElements.define('turbo-stream-source-signalr', TurboStreamSourceSignalR);\n}\n\n// Export for testing and programmatic use\nexport { TurboStreamSourceSignalR, connectionManager };\n\n// Export a helper to get connection state\nexport function getConnectionState() {\n    return connectionManager.getState();\n}\n\n// Export a helper to manually close the connection\nexport async function disconnect() {\n    await connectionManager.closeConnection();\n}\n"],"names":["signalR"],"mappings":"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"}