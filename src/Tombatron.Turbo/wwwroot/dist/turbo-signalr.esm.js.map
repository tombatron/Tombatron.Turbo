{"version":3,"file":"turbo-signalr.esm.js","sources":["../src/turbo-stream-source-signalr.js"],"sourcesContent":["/**\n * Turbo Stream Source SignalR - Custom element for receiving Turbo Streams via SignalR\n *\n * This custom element connects to an ASP.NET Core SignalR hub and subscribes to\n * named streams. When Turbo Stream messages are received, they are rendered\n * using the Hotwire Turbo library.\n *\n * Usage:\n *   <turbo-stream-source-signalr stream=\"my-stream\" hub-url=\"/turbo-hub\"></turbo-stream-source-signalr>\n */\n\nimport * as signalR from '@microsoft/signalr';\n\n// Singleton connection manager\nconst connectionManager = {\n    /** @type {signalR.HubConnection|null} */\n    connection: null,\n\n    /** @type {Map<string, number>} Stream name to reference count */\n    streamRefs: new Map(),\n\n    /** @type {Set<string>} Streams currently subscribed on the server */\n    subscribedStreams: new Set(),\n\n    /** @type {string|null} Current hub URL */\n    hubUrl: null,\n\n    /** @type {boolean} Whether we're currently connected */\n    isConnected: false,\n\n    /** @type {boolean} Whether we're currently connecting */\n    isConnecting: false,\n\n    /** @type {Array<Function>} Callbacks waiting for connection */\n    connectionCallbacks: [],\n\n    /**\n     * Gets or creates a connection to the specified hub URL.\n     * @param {string} hubUrl - The SignalR hub URL\n     * @returns {Promise<signalR.HubConnection>}\n     */\n    async getConnection(hubUrl) {\n        // If we have a connection to a different URL, close it\n        if (this.connection && this.hubUrl !== hubUrl) {\n            await this.closeConnection();\n        }\n\n        // If already connected, return the connection\n        if (this.connection && this.isConnected) {\n            return this.connection;\n        }\n\n        // If currently connecting, wait for it\n        if (this.isConnecting) {\n            return new Promise((resolve) => {\n                this.connectionCallbacks.push(() => resolve(this.connection));\n            });\n        }\n\n        // Create new connection\n        this.isConnecting = true;\n        this.hubUrl = hubUrl;\n\n        this.connection = new signalR.HubConnectionBuilder()\n            .withUrl(hubUrl)\n            .withAutomaticReconnect({\n                nextRetryDelayInMilliseconds: (retryContext) => {\n                    // Exponential backoff: 0s, 2s, 4s, 8s, 16s, max 30s\n                    const delay = Math.min(Math.pow(2, retryContext.previousRetryCount) * 1000, 30000);\n                    return delay;\n                }\n            })\n            .configureLogging(signalR.LogLevel.Warning)\n            .build();\n\n        // Set up message handler\n        this.connection.on('TurboStream', (html) => {\n            this.handleTurboStream(html);\n        });\n\n        // Set up reconnection handlers\n        this.connection.onreconnecting(() => {\n            this.isConnected = false;\n            this.dispatchConnectionEvent('turbo:signalr:reconnecting');\n        });\n\n        this.connection.onreconnected(async () => {\n            this.isConnected = true;\n            this.dispatchConnectionEvent('turbo:signalr:reconnected');\n\n            // Resubscribe to all active streams\n            await this.resubscribeAll();\n        });\n\n        this.connection.onclose(() => {\n            this.isConnected = false;\n            this.subscribedStreams.clear();\n            this.dispatchConnectionEvent('turbo:signalr:disconnected');\n        });\n\n        try {\n            await this.connection.start();\n            this.isConnected = true;\n            this.isConnecting = false;\n            this.dispatchConnectionEvent('turbo:signalr:connected');\n\n            // Notify any waiting callbacks\n            this.connectionCallbacks.forEach((cb) => cb());\n            this.connectionCallbacks = [];\n\n            return this.connection;\n        } catch (error) {\n            this.isConnecting = false;\n            this.dispatchConnectionEvent('turbo:signalr:error', { error });\n            throw error;\n        }\n    },\n\n    /**\n     * Closes the current connection.\n     */\n    async closeConnection() {\n        if (this.connection) {\n            await this.connection.stop();\n            this.connection = null;\n            this.hubUrl = null;\n            this.isConnected = false;\n            this.subscribedStreams.clear();\n        }\n    },\n\n    /**\n     * Subscribes to a stream, incrementing the reference count.\n     * @param {string} streamName - The stream name to subscribe to\n     * @param {string} hubUrl - The SignalR hub URL\n     * @returns {Promise<boolean>} True if subscription was successful\n     */\n    async subscribe(streamName, hubUrl) {\n        if (typeof streamName !== 'string') {\n            throw new Error('Stream name is required and must be a string');\n        }\n\n        const trimmedName = streamName.trim();\n        if (trimmedName.length === 0) {\n            throw new Error('Stream name cannot be empty or whitespace');\n        }\n\n        // Increment reference count\n        const currentCount = this.streamRefs.get(trimmedName) || 0;\n        this.streamRefs.set(trimmedName, currentCount + 1);\n\n        // If this is the first reference, subscribe on the server\n        if (currentCount === 0) {\n            try {\n                const connection = await this.getConnection(hubUrl);\n                const success = await connection.invoke('Subscribe', trimmedName);\n\n                if (success) {\n                    this.subscribedStreams.add(trimmedName);\n                    return true;\n                } else {\n                    // Subscription was denied (authorization failed)\n                    this.streamRefs.set(trimmedName, currentCount);\n                    return false;\n                }\n            } catch (error) {\n                // Rollback reference count on error\n                this.streamRefs.set(trimmedName, currentCount);\n                throw error;\n            }\n        }\n\n        return true;\n    },\n\n    /**\n     * Unsubscribes from a stream, decrementing the reference count.\n     * @param {string} streamName - The stream name to unsubscribe from\n     * @returns {Promise<void>}\n     */\n    async unsubscribe(streamName) {\n        if (!streamName) {\n            return;\n        }\n\n        const trimmedName = streamName.trim();\n        const currentCount = this.streamRefs.get(trimmedName) || 0;\n\n        if (currentCount <= 0) {\n            return;\n        }\n\n        const newCount = currentCount - 1;\n\n        if (newCount === 0) {\n            // Last reference, unsubscribe from server\n            this.streamRefs.delete(trimmedName);\n            this.subscribedStreams.delete(trimmedName);\n\n            if (this.connection && this.isConnected) {\n                try {\n                    await this.connection.invoke('Unsubscribe', trimmedName);\n                } catch (error) {\n                    // Ignore errors during unsubscribe (connection might be closing)\n                    // eslint-disable-next-line no-console\n                    console.warn('Error unsubscribing from stream:', error);\n                }\n            }\n        } else {\n            this.streamRefs.set(trimmedName, newCount);\n        }\n    },\n\n    /**\n     * Resubscribes to all active streams after reconnection.\n     */\n    async resubscribeAll() {\n        if (!this.connection || !this.isConnected) {\n            return;\n        }\n\n        const streamsToResubscribe = Array.from(this.streamRefs.keys());\n\n        for (const streamName of streamsToResubscribe) {\n            try {\n                const success = await this.connection.invoke('Subscribe', streamName);\n                if (success) {\n                    this.subscribedStreams.add(streamName);\n                }\n            } catch (error) {\n                // eslint-disable-next-line no-console\n                console.warn('Error resubscribing to stream:', streamName, error);\n            }\n        }\n    },\n\n    /**\n     * Handles incoming Turbo Stream messages.\n     * @param {string} html - The Turbo Stream HTML\n     */\n    handleTurboStream(html) {\n        if (!html) {\n            return;\n        }\n\n        // Check if Turbo.js is available\n        if (typeof window !== 'undefined' && window.Turbo && typeof window.Turbo.renderStreamMessage === 'function') {\n            window.Turbo.renderStreamMessage(html);\n        } else {\n            // Fallback: manually insert the stream actions\n            this.manualRenderStream(html);\n        }\n    },\n\n    /**\n     * Manually renders Turbo Stream HTML when Turbo.js is not available.\n     * @param {string} html - The Turbo Stream HTML\n     */\n    manualRenderStream(html) {\n        const template = document.createElement('template');\n        template.innerHTML = html;\n\n        const streams = template.content.querySelectorAll('turbo-stream');\n\n        for (const stream of streams) {\n            const action = stream.getAttribute('action');\n            const target = stream.getAttribute('target');\n            const templateContent = stream.querySelector('template');\n\n            if (!target) {\n                continue;\n            }\n\n            const targetElement = document.getElementById(target);\n\n            if (!targetElement && action !== 'remove') {\n                continue;\n            }\n\n            const content = templateContent ? templateContent.content.cloneNode(true) : null;\n\n            switch (action) {\n                case 'append':\n                    if (content) {\n                        targetElement.appendChild(content);\n                    }\n                    break;\n                case 'prepend':\n                    if (content) {\n                        targetElement.prepend(content);\n                    }\n                    break;\n                case 'replace':\n                    if (content && targetElement.parentNode) {\n                        targetElement.parentNode.replaceChild(content, targetElement);\n                    }\n                    break;\n                case 'update':\n                    if (targetElement) {\n                        targetElement.innerHTML = '';\n                        if (content) {\n                            targetElement.appendChild(content);\n                        }\n                    }\n                    break;\n                case 'remove':\n                    if (targetElement) {\n                        targetElement.remove();\n                    }\n                    break;\n                case 'before':\n                    if (content && targetElement.parentNode) {\n                        targetElement.parentNode.insertBefore(content, targetElement);\n                    }\n                    break;\n                case 'after':\n                    if (content && targetElement.parentNode) {\n                        targetElement.parentNode.insertBefore(content, targetElement.nextSibling);\n                    }\n                    break;\n            }\n        }\n    },\n\n    /**\n     * Dispatches a custom event on the document.\n     * @param {string} eventName - The event name\n     * @param {object} detail - Optional event detail\n     */\n    dispatchConnectionEvent(eventName, detail = {}) {\n        if (typeof document !== 'undefined') {\n            document.dispatchEvent(new CustomEvent(eventName, { detail }));\n        }\n    },\n\n    /**\n     * Gets the current connection state.\n     * @returns {{ isConnected: boolean, streamCount: number, streams: string[] }}\n     */\n    getState() {\n        return {\n            isConnected: this.isConnected,\n            streamCount: this.streamRefs.size,\n            streams: Array.from(this.streamRefs.keys())\n        };\n    }\n};\n\n/**\n * Custom element for Turbo Stream sources via SignalR.\n *\n * @example\n * <turbo-stream-source-signalr stream=\"notifications\" hub-url=\"/turbo-hub\">\n * </turbo-stream-source-signalr>\n */\nclass TurboStreamSourceSignalR extends HTMLElement {\n    static get observedAttributes() {\n        return ['stream', 'hub-url'];\n    }\n\n    constructor() {\n        super();\n        this._streamName = null;\n        this._hubUrl = null;\n        this._subscribed = false;\n    }\n\n    /**\n     * Called when the element is added to the DOM.\n     */\n    async connectedCallback() {\n        this._streamName = this.getAttribute('stream');\n        this._hubUrl = this.getAttribute('hub-url') || '/turbo-hub';\n\n        if (this._streamName) {\n            await this._subscribe();\n        }\n    }\n\n    /**\n     * Called when the element is removed from the DOM.\n     */\n    async disconnectedCallback() {\n        if (this._subscribed && this._streamName) {\n            await connectionManager.unsubscribe(this._streamName);\n            this._subscribed = false;\n        }\n    }\n\n    /**\n     * Called when an observed attribute changes.\n     * @param {string} name - Attribute name\n     * @param {string|null} oldValue - Previous value\n     * @param {string|null} newValue - New value\n     */\n    async attributeChangedCallback(name, oldValue, newValue) {\n        if (oldValue === newValue) {\n            return;\n        }\n\n        if (name === 'stream') {\n            // Unsubscribe from old stream\n            if (this._subscribed && this._streamName) {\n                await connectionManager.unsubscribe(this._streamName);\n                this._subscribed = false;\n            }\n\n            // Subscribe to new stream\n            this._streamName = newValue;\n            if (this._streamName && this.isConnected) {\n                await this._subscribe();\n            }\n        } else if (name === 'hub-url') {\n            this._hubUrl = newValue || '/turbo-hub';\n\n            // Reconnect with new URL if already subscribed\n            if (this._subscribed && this._streamName) {\n                await connectionManager.unsubscribe(this._streamName);\n                this._subscribed = false;\n                await this._subscribe();\n            }\n        }\n    }\n\n    /**\n     * Subscribes to the current stream.\n     */\n    async _subscribe() {\n        if (!this._streamName) {\n            return;\n        }\n\n        // Ensure hubUrl is set (may not be if attributeChangedCallback fires for 'stream' before 'hub-url')\n        if (!this._hubUrl) {\n            this._hubUrl = this.getAttribute('hub-url') || '/turbo-hub';\n        }\n\n        try {\n            const success = await connectionManager.subscribe(this._streamName, this._hubUrl);\n            this._subscribed = success;\n\n            if (!success) {\n                this.dispatchEvent(new CustomEvent('turbo:stream:unauthorized', {\n                    bubbles: true,\n                    detail: { stream: this._streamName }\n                }));\n            }\n        } catch (error) {\n            this.dispatchEvent(new CustomEvent('turbo:stream:error', {\n                bubbles: true,\n                detail: { stream: this._streamName, error }\n            }));\n        }\n    }\n\n    /**\n     * Gets the current stream name.\n     * @returns {string|null}\n     */\n    get stream() {\n        return this._streamName;\n    }\n\n    /**\n     * Sets the stream name.\n     * @param {string} value\n     */\n    set stream(value) {\n        this.setAttribute('stream', value);\n    }\n\n    /**\n     * Gets the hub URL.\n     * @returns {string}\n     */\n    get hubUrl() {\n        return this._hubUrl || '/turbo-hub';\n    }\n\n    /**\n     * Sets the hub URL.\n     * @param {string} value\n     */\n    set hubUrl(value) {\n        this.setAttribute('hub-url', value);\n    }\n}\n\n// Register the custom element\nif (typeof customElements !== 'undefined') {\n    customElements.define('turbo-stream-source-signalr', TurboStreamSourceSignalR);\n}\n\n// Export for testing and programmatic use\nexport { TurboStreamSourceSignalR, connectionManager };\n\n// Export a helper to get connection state\nexport function getConnectionState() {\n    return connectionManager.getState();\n}\n\n// Export a helper to manually close the connection\nexport async function disconnect() {\n    await connectionManager.closeConnection();\n}\n"],"names":[],"mappings":"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"}